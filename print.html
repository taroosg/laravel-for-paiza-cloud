<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>laravel-for-paiza-cloud</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="laravel/laravel_setup/index.html"><strong aria-hidden="true">1.</strong> Laravel 事前準備</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel_setup/setup-for-paiza-cloud.html"><strong aria-hidden="true">1.1.</strong> 【Paiza Cloud 編】環境構築</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel01/index.html"><strong aria-hidden="true">2.</strong> Laravel 01</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel01/about-laravel-and-mvc.html"><strong aria-hidden="true">2.1.</strong> Laravel と MVC フレームワーク</a></li><li class="chapter-item expanded "><a href="laravel/laravel_setup/add-laravel-breeze.html"><strong aria-hidden="true">2.2.</strong> ライブラリ準備</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/migration.html"><strong aria-hidden="true">2.3.</strong> マイグレーションによるテーブル作成</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/route-and-controller.html"><strong aria-hidden="true">2.4.</strong> ルーティングとコントローラ</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/views.html"><strong aria-hidden="true">2.5.</strong> 必要な画面の作成と動作確認</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/create.html"><strong aria-hidden="true">2.6.</strong> tweet 作成処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel01/read.html"><strong aria-hidden="true">2.7.</strong> tweet 一覧画面の実装</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel02/index.html"><strong aria-hidden="true">3.</strong> Laravel 02</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel02/show.html"><strong aria-hidden="true">3.1.</strong> tweet 詳細画面の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/delete.html"><strong aria-hidden="true">3.2.</strong> tweet 削除処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/update.html"><strong aria-hidden="true">3.3.</strong> tweet 更新処理の実装</a></li><li class="chapter-item expanded "><a href="laravel/laravel02/auth.html"><strong aria-hidden="true">3.4.</strong> tweet とユーザ認証の連携</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel03/index.html"><strong aria-hidden="true">4.</strong> Laravel 03</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="laravel/laravel03/mypage.html"><strong aria-hidden="true">4.1.</strong> マイページ機能の実装（1 対多のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/auther.html"><strong aria-hidden="true">4.2.</strong> 投稿者名の表示（多対 1 のデータ）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite01.html"><strong aria-hidden="true">4.3.</strong> Favorite 機能 1（多対多のデータ・中間テーブル）</a></li><li class="chapter-item expanded "><a href="laravel/laravel03/favorite02.html"><strong aria-hidden="true">4.4.</strong> Favorite 機能 2（各処理の実装）</a></li></ol></li><li class="chapter-item expanded "><a href="laravel/laravel03/github-push.html"><strong aria-hidden="true">5.</strong> GitHub へ push</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">laravel-for-paiza-cloud</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="laravel-事前準備"><a class="header" href="#laravel-事前準備">Laravel 事前準備</a></h1>
<p>Laravel で開発をするためには，開発環境を用意する必要がある．一人で開発するときだけでなく，複数人で開発する際には「同じ開発環境」を揃えることが大切である．</p>
<p>更に，フレームワークやライブラリを多用する場合，個々の PC 環境によって細かいバージョンの差異や動作具合に影響が生じることがある．</p>
<p>主な Laravel の開発環境には以下のようなものがある．</p>
<ul>
<li>ローカル環境（XAMPP など）</li>
<li>ローカル上の仮想マシン（vagrant など）</li>
<li>仮想コンテナ（Docker など）</li>
<li>クラウド上の仮想マシン（AWS Cloud9，Paiza Cloud など）</li>
</ul>
<p>今回は Paiza Cloud が提供するクラウド環境を用いて開発を行う．</p>
<h2 id="多用するコマンドなどまとめ"><a class="header" href="#多用するコマンドなどまとめ">多用するコマンドなどまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="laravel-アプリケーションの立ち上げ"><a class="header" href="#laravel-アプリケーションの立ち上げ">Laravel アプリケーションの立ち上げ</a></h3>
<pre><code class="language-bash">$ php artisan serve
</code></pre>
<h3 id="laravel-アプリケーション画面の確認"><a class="header" href="#laravel-アプリケーション画面の確認">Laravel アプリケーション画面の確認</a></h3>
<p>上記コマンド実行後，左側の「8080」をクリック．</p>
<h3 id="phpmyadmin-画面の確認"><a class="header" href="#phpmyadmin-画面の確認">phpmyadmin 画面の確認</a></h3>
<p>左側の「80」をクリックし，表示された画面の URL の後に <code>/phpmyadmin</code> を追加．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="paiza-cloud-編環境構築"><a class="header" href="#paiza-cloud-編環境構築">【Paiza Cloud 編】環境構築</a></h1>
<p>一連の講義では，PHP のフレームワークである Laravel を用いて twitter 風の SNS アプリケーション「Laratter」を実装しながら，Web アプリケーションにおける基本的な処理をマスターする．</p>
<h2 id="paiza-cloud-上に-laravel-環境を準備"><a class="header" href="#paiza-cloud-上に-laravel-環境を準備">Paiza Cloud 上に Laravel 環境を準備</a></h2>
<p>下記の URL にアクセスする．</p>
<p><a href="https://paiza.cloud/ja/">https://paiza.cloud/ja/</a></p>
<p>ログインする．アカウントなければ適当に作成する．</p>
<p>ログインしたら「新規サーバ作成」をクリック．</p>
<ul>
<li>名前は適当につける．</li>
<li>Laravel，MySQL，phpmyadmin を選択する．</li>
<li>サーバ作成ボタンクリックしてサーバの準備は完了．</li>
</ul>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_create_server.png" alt="サーバ作成画面" /></p>
<h2 id="git-のバージョンアップ"><a class="header" href="#git-のバージョンアップ">Git のバージョンアップ</a></h2>
<p>バージョンが古いので最新にしておく．</p>
<p>左側のターミナルをクリックしてターミナルを起動する．</p>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_start_terminal.png" alt="ターミナル起動" /></p>
<p>下記の手順でコマンドを実行し，Git のバージョンを最新にする．</p>
<pre><code class="language-bash"># Git リポジトリの追加
$ sudo add-apt-repository ppa:git-core/ppa

# 実行結果（中略）
The most current stable version of Git for Ubuntu.
...
W: Some index files failed to download. They have been ignored, or old ones used instead.

</code></pre>
<pre><code class="language-bash"># パッケージのアップデート
$ sudo apt update

# 実行結果（中略）
Hit:1 http://ap-northeast-1.ec2.archive.ubuntu.com/ubuntu bionic InRelease
Hit:2 http://ap-northeast-1.ec2.archive.ubuntu.com/ubuntu bionic-updates InRelease
...
W: Some index files failed to download. They have been ignored, or old ones used instead.

</code></pre>
<pre><code class="language-bash"># Git のインストール
$ sudo apt install git

# 実行結果（中略）
Reading package lists... Done
Building dependency tree
Reading state information... Done
...
Setting up git (1:2.33.1-0ppa1~ubuntu18.04.1) ...
Processing triggers for man-db (2.8.3-2ubuntu0.1) ...

</code></pre>
<pre><code class="language-bash"># バージョン確認
$ git --version

# 実行結果
git version 2.33.1

</code></pre>
<h2 id="laravel-プロジェクトの作成"><a class="header" href="#laravel-プロジェクトの作成">Laravel プロジェクトの作成</a></h2>
<p>引き続きターミナルで操作を行う．</p>
<p>下記コマンドを実行して Laravel のプロジェクトを作成する．</p>
<pre><code class="language-bash">$ composer create-project laravel/laravel laratter --prefer-dist
</code></pre>
<p>完了したら下記コマンドを実行する．</p>
<pre><code class="language-bash">$ cd laratter
$ php artisan serve

# 実行結果
Starting Laravel development server: http://127.0.0.1:8000

</code></pre>
<p>左側の「8000」をクリックして Laravel のアプリケーションを立ち上げる．</p>
<p>下記の画面が表示されれば OK！</p>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_start_laravel.png" alt="laravel画面表示" /></p>
<p>サーバを終了するときは「<code>ctrl + c</code>」を入力する．</p>
<h2 id="隠しファイルの表示"><a class="header" href="#隠しファイルの表示">隠しファイルの表示</a></h2>
<p>適当なフォルダ上で右クリックし，「隠しファイルを表示」をクリックする．</p>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_show_hidden_files.png" alt="隠しファイル設定" /></p>
<h2 id="phpmyadmin"><a class="header" href="#phpmyadmin">phpmyadmin</a></h2>
<p>左側の「80」をクリックし，アドレスバーに <code>/phpmyadmin</code> を追加して Enter．</p>
<p>下記画面が表示されれば OK！</p>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_phpmyadmin.png" alt="phpmyadmin画面" /></p>
<h2 id="db-の作成"><a class="header" href="#db-の作成">DB の作成</a></h2>
<p>phpmyadmin 画面からデータベースを作成する．</p>
<p>Laravel ではテーブル作成は「マイグレーション」という仕組みを使用する（後述）ので，DB のみ準備しておけば OK．</p>
<p>phpmyadmin 画面の SQL タブをクリックし，下記の SQL を実行する．</p>
<pre><code class="language-sql">CREATE DATABASE laratter;
</code></pre>
<p>Databases タブをクリックし，laratter データベースが作成されていれば OK！</p>
<p><img src="laravel/laravel_setup/./img/laravel_paiza_setup_create_database.png" alt="DB作成確認" /></p>
<h2 id="laravel-から-db-に接続するための設定"><a class="header" href="#laravel-から-db-に接続するための設定">Laravel から DB に接続するための設定</a></h2>
<p>続いて，Laravel から MySQL にアクセスするための設定を行う．</p>
<p>エディタから<code>.env</code>ファイルを開く．<code>.env</code>ファイルは<code>laratter</code>ディレクトリの直下に配置されている．</p>
<p>10 行目から 15 行目を以下のように編集する．</p>
<pre><code class="language-env">DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laratter
DB_USERNAME=root
DB_PASSWORD=

</code></pre>
<p>それぞれ下記の意味となっている．デプロイする場合などはサービス提供者側からそれぞれ情報が提供されるため，必要に応じて編集する．</p>
<table><thead><tr><th>項目</th><th>意味</th></tr></thead><tbody>
<tr><td>DB_CONNECTION</td><td>DB の種類</td></tr>
<tr><td>DB_HOST</td><td>DB のホスト名</td></tr>
<tr><td>DB_PORT</td><td>DB のポート</td></tr>
<tr><td>DB_DATABASE</td><td>DB 名</td></tr>
<tr><td>DB_USERNAME</td><td>DB にログインするときのユーザ名</td></tr>
<tr><td>DB_PASSWORD</td><td>DB にログインするときのパスワード</td></tr>
</tbody></table>
<p>もし<code>.env</code>ファイルを更新する場合はキャッシュをクリアする．</p>
<blockquote>
<p>設定ファイルはサーバ起動時にキャッシュに保存されるため，変更した場合は「キャッシュをクリアする」「コンテナを立ち上げ直す」のどちらかが必要になる．</p>
<p>キャッシュクリアのコマンドを実行する場合は Laravel の仮想コンテナにログインした状態で行うこと．</p>
</blockquote>
<pre><code class="language-bash">$ php artisan config:cache
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Configuration cache cleared!
Configuration cached successfully!
</code></pre>
<h2 id="https-設定の追加"><a class="header" href="#https-設定の追加">HTTPS 設定の追加</a></h2>
<p>Paiza Cloud 上では常に https で通信が行われる．そのため，Laravel 側でも同様の設定をしておかないとうまく動かない．</p>
<p><code>app/Providers/AppServiceProvider.php</code> を以下のように編集する．</p>
<pre><code class="language-php">&lt;?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
// 🔽 1行追加 🔽
use Illuminate\Routing\UrlGenerator;

class AppServiceProvider extends ServiceProvider
{
  /**
   * Register any application services.
   *
   * @return void
   */
  public function register()
  {
    //
  }

  /**
   * Bootstrap any application services.
   *
   * @return void
   */
  // 🔽 編集 🔽
  public function boot(UrlGenerator $url)
  {
    $url-&gt;forceScheme('https');
  }
}

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-01"><a class="header" href="#laravel-01">Laravel 01</a></h1>
<h2 id="本日の内容"><a class="header" href="#本日の内容">本日の内容</a></h2>
<ul>
<li>MVC フレームワークについての解説．</li>
<li>開発環境についての解説．</li>
<li>SNS アプリケーションの実装（データ作成，一覧表示まで）．</li>
</ul>
<h2 id="本日の目標"><a class="header" href="#本日の目標">本日の目標</a></h2>
<ul>
<li>MVC フレームワークである Laravel の動き方や考え方を学ぶ．</li>
<li>SNS アプリケーションの実装を通して，開発の手順や流れに慣れる．</li>
<li>PHP での実装と Laravel での実装について，共通点や相違点を把握する．</li>
</ul>
<h2 id="ルーティング表"><a class="header" href="#ルーティング表">ルーティング表</a></h2>
<p>後ほど解説します！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドなどまとめ-1"><a class="header" href="#多用するコマンドなどまとめ-1">多用するコマンドなどまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="laravel-アプリケーションの立ち上げ-1"><a class="header" href="#laravel-アプリケーションの立ち上げ-1">Laravel アプリケーションの立ち上げ</a></h3>
<pre><code class="language-bash">$ php artisan serve
</code></pre>
<h3 id="laravel-アプリケーション画面の確認-1"><a class="header" href="#laravel-アプリケーション画面の確認-1">Laravel アプリケーション画面の確認</a></h3>
<p>上記コマンド実行後，左側の「8080」をクリック．</p>
<h3 id="phpmyadmin-画面の確認-1"><a class="header" href="#phpmyadmin-画面の確認-1">phpmyadmin 画面の確認</a></h3>
<p>左側の「80」をクリックし，表示された画面の URL の後に <code>/phpmyadmin</code> を追加．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-と-mvc-フレームワーク"><a class="header" href="#laravel-と-mvc-フレームワーク">Laravel と MVC フレームワーク</a></h1>
<p>Laravel とは PHP の MVC フレームワークである．</p>
<h2 id="フレームワークとは"><a class="header" href="#フレームワークとは">フレームワークとは</a></h2>
<p>フレームワークとは．．．</p>
<ul>
<li>ある言語で作るシステムの枠組み．考え方．</li>
<li>よく使う関数やクラスが用意されている．</li>
<li>規則が決まっているので，誰が書いても似たコードになる．</li>
</ul>
<h3 id="メリットとデメリット"><a class="header" href="#メリットとデメリット">メリットとデメリット</a></h3>
<ul>
<li>✅ 組み込まれている機能があるので実装の負荷が少ない．</li>
<li>✅ コードの品質担保による保守管理の負荷低減．</li>
<li>✅ セキュリティ面での担保．</li>
<li>🔼 学習コスト．</li>
<li>🔼 環境構築．</li>
</ul>
<h3 id="各言語のフレームワークの例"><a class="header" href="#各言語のフレームワークの例">各言語のフレームワークの例</a></h3>
<table><thead><tr><th>言語</th><th>フレームワーク</th></tr></thead><tbody>
<tr><td>PHP</td><td>Laravel, CakePHP, Symphony</td></tr>
<tr><td>Ruby</td><td>Ruby on Rails</td></tr>
<tr><td>Python</td><td>Django, Flask</td></tr>
<tr><td>Node.js</td><td>Express, NestJS</td></tr>
<tr><td>JavaScript</td><td>Next.js, Gatsby.js, Nuxt.js</td></tr>
</tbody></table>
<p>※あくまで一例，他にもたくさんあります．．！</p>
<h3 id="laravel-の特徴"><a class="header" href="#laravel-の特徴">Laravel の特徴</a></h3>
<ul>
<li>今最もアツい PHP フレームワーク！</li>
<li>Web サービスで使用する機能が豊富に用意されている．
<ul>
<li>DB 操作関連の機能（論理削除など）</li>
<li>メール通知機能</li>
</ul>
</li>
<li>画面を柔軟に作成できる blade テンプレート．</li>
<li><code>artisan</code>コマンドによる手軽なライブラリ操作．</li>
<li>とにかく自由（ディレクトリ構成，処理の記述場所など）</li>
</ul>
<h2 id="mvc-とは"><a class="header" href="#mvc-とは">MVC とは</a></h2>
<p><strong>MVC とは，役割分担の概念であるッ！</strong></p>
<p>これまでは適当な PHP ファイルに処理を全部書いていた！</p>
<ul>
<li>ファイル数が増える．．．</li>
<li>あの処理，どのファイルに書いたっけ．．？？</li>
<li>バグあったけど次の処理が他の人の書いたファイルに．．．（チーム開発）</li>
</ul>
<p>=&gt; いずれ詰む未来が見える．．．</p>
<p>=&gt; せや，処理毎に別々のところに書いて管理や分類をしやすくしたろ！MVC の 3 つくらいでええやろ！</p>
<h3 id="役割分担"><a class="header" href="#役割分担">役割分担</a></h3>
<table><thead><tr><th>name</th><th>役割</th></tr></thead><tbody>
<tr><td>Model</td><td>データの操作を行う役割．<br>データの「作成」「参照」「更新」「削除」し，その結果を出力．</td></tr>
<tr><td>View</td><td>ブラウザの表示領域を作成する役割．<br>受け取ったデータ処理の結果を html に埋め込み，出力する．</td></tr>
<tr><td>Controller</td><td>リクエストとレスポンスを行う．その間のことをいい感じにやる．<br>Model と View に司令を出す，処理の流れを決める役割．</td></tr>
<tr><td>Route</td><td>アクセスされた URL に応じて処理を振り分ける．URL と Controller の関数の対応を決める．<br>実際の処理は Controller を通じて Model や View が実行する．</td></tr>
</tbody></table>
<h3 id="処理のイメージ"><a class="header" href="#処理のイメージ">処理のイメージ</a></h3>
<p>MVC では処理によって役割分担されているため，「処理の順番」と「データ流れ」を把握することが理解への近道である．</p>
<p>例として，DB から取り出したデータを一覧画面に表示する流れを考えてみる．</p>
<h3 id="リクエストからの処理の流れ"><a class="header" href="#リクエストからの処理の流れ">リクエストからの処理の流れ</a></h3>
<p>リクエスト -&gt; Route -&gt; Controller の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_01.svg" alt="MVCの流れ1" /></p>
<h3 id="db-から取り出したデータの流れ"><a class="header" href="#db-から取り出したデータの流れ">DB から取り出したデータの流れ</a></h3>
<p>Model -&gt; Controller -&gt; View の順で処理が実行される．</p>
<p><img src="laravel/laravel01/./img/laravel_mvc_02.svg" alt="MVCの流れ2" /></p>
<h2 id="コツ"><a class="header" href="#コツ">コツ</a></h2>
<h3 id="習うより慣れろッ"><a class="header" href="#習うより慣れろッ">習うより慣れろッ！</a></h3>
<ul>
<li>初見で理解することは不可能！
<ul>
<li>まずはアプリケーションを作って動かそう！</li>
<li>処理を見ながら，どこでどの処理を行っているのかを考えよう！</li>
</ul>
</li>
<li>MVC 間でのデータの流れを追えるようになると Good！！</li>
<li>慣れゲー &amp; 周回ゲー！
<ul>
<li>何度も作ることで処理のイメージが湧き，余裕が生まれる．</li>
<li>「そういえば前回もこの処理書いたな」で OK．</li>
<li>10 周くらいするとだいぶわかる！</li>
</ul>
</li>
</ul>
<h3 id="余計なことをせずにフレームワークに従う"><a class="header" href="#余計なことをせずにフレームワークに従う">余計なことをせずにフレームワークに従う</a></h3>
<p><strong>フレームワーク &gt; 越えられない壁 &gt;&gt;&gt; 人間</strong></p>
<ul>
<li>フレームワークは人類の叡智！</li>
<li>素人が安易に改造すると台無し．</li>
<li>細かい設定などは弄らない！</li>
<li>自分で実装せずにフレームワークに用意された機能を使え！</li>
<li>ゴリ押しで書くな！（よくある処理はドキュメントに載ってる）</li>
</ul>
<!-- ## Get Started!!!

**【超重要】下記の手順でAWS Educateアカウントにログイン**

1. [https://aws.amazon.com/jp/education/awseducate/](https://aws.amazon.com/jp/education/awseducate/)にアクセス
2. 「AWS Educate にサインイン」をクリック
3. ページ上段 「My Classroom」をクリック
4. 今回のクラスに入る -> AWS console
5. 今後作業途中で再度ログインが必要になっても上記手順でログイン！ -->
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ライブラリ準備"><a class="header" href="#ライブラリ準備">ライブラリ準備</a></h1>
<h2 id="ライブラリ準備-1"><a class="header" href="#ライブラリ準備-1">ライブラリ準備</a></h2>
<p>作成するアプリケーションでライブラリを使用する場合はコマンドでインストールを行う．今回は認証を実装するための<code>Laravel Breeze</code>をインストールする．</p>
<!-- Laravel のプロジェクト内でコマンドを実行する場合には，下記コマンドで仮想コンテナにログインする必要がある．

```bash
$ docker-compose exec laravel.test bash
root@81f8517c4e7f:/var/www/html#
```

仮想コンテナから出る場合には下記のコマンドを実行する．

```bash
root@81f8517c4e7f:/var/www/html# exit
exit
$
```

**以降のコマンドは仮想コンテナにログインした状態（ターミナルが`/var/www/html# `になっている状態）で行うこと** -->
<p><strong>まず，作成したアプリケーションのディレクトリ（laratter ディレクトリ）に移動しておく．</strong></p>
<pre><code class="language-bash">$ cd laratter
</code></pre>
<blockquote>
<p><strong>💡 Key Point</strong></p>
<p><strong>Laravel アプリケーションに対してコマンドを実行する場合にはアプリケーションのディレクトリ内でコマンドを実行する．</strong></p>
</blockquote>
<p>下記コマンドを実行し，必要なファイルをダウンロードする．</p>
<pre><code class="language-bash">$ composer require laravel/breeze --dev
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">...
Discovered Package: nesbot/carbon
Discovered Package: nunomaduro/collision
Package manifest generated successfully.
73 packages you are using are looking for funding.
Use the `composer fund` command to find out more!
</code></pre>
<p>下記コマンドでインストールする．</p>
<pre><code class="language-bash">$ php artisan breeze:install
</code></pre>
<p>実行結果</p>
<pre><code class="language-bash">Breeze scaffolding installed successfully.
Please execute the &quot;npm install &amp;&amp; npm run dev&quot; command to build your assets.
</code></pre>
<p>下記コマンドを実行し，その他必要なパッケージをインストールしてビルドする（ここで Node.js が動く）．</p>
<pre><code class="language-bash">$ npm install &amp;&amp; npm run dev
</code></pre>
<p>実行結果（やや時間がかかる）</p>
<pre><code class="language-bash">✔ Compiled Successfully in 4720ms
┌───────────────────────────────────────────────────────────────────┬──────────┐
│                                                              File │ Size     │
├───────────────────────────────────────────────────────────────────┼──────────┤
│                                                        /js/app.js │ 673 KiB  │
│                                                       css/app.css │ 3.82 MiB │
└───────────────────────────────────────────────────────────────────┴──────────┘
webpack compiled successfully
</code></pre>
<p>ブラウザで localhost にアクセスし，動作を確認する．</p>
<p>以下の画面が表示されれば OK（右上に<code>Login</code>と<code>register</code>が表示される）．</p>
<p><img src="laravel/laravel_setup/./img/breeze-installed.png" alt="breezeインストール確認" /></p>
<p>右上の<code>register</code>をクリックするとユーザ登録画面に移動するが，まだこの段階ではユーザ登録機能は動作しない．ユーザ登録画面が表示されれば OK．</p>
<p><img src="laravel/laravel_setup/./img/register.png" alt="register画面" /></p>
<p>ここまででライブラリの準備は完了．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイグレーションによるテーブル作成"><a class="header" href="#マイグレーションによるテーブル作成">マイグレーションによるテーブル作成</a></h1>
<p>プロダクトの実装を進める上で，Laravel コンテナ内や DB コンテナ内など「実行場所」を確認すること．</p>
<h2 id="テーブル設計マイグレーションファイル"><a class="header" href="#テーブル設計マイグレーションファイル">テーブル設計（マイグレーションファイル）</a></h2>
<!-- > **📦 Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<p>今回のアプリケーションは twitter ライクな SNS なので「tweets」テーブルを作成する．</p>
<p>Laravel では「マイグレーション」という仕組みを使用してテーブルの管理を行う．また，テーブル内のデータは「Model」を使用して操作する．Laravel では<code>Eroquent Model</code>と呼ばれる ORM を使用する．</p>
<blockquote>
<p>【解説 / マイグレーション】</p>
<ul>
<li>マイグレーションとは「マイグレーションファイル」を用いてテーブルを管理する仕組み．</li>
<li>「マイグレーションファイル」にテーブル名やカラム名を記述し，指定されたコマンドを実行することで設定したテーブルが生成される．</li>
</ul>
</blockquote>
<blockquote>
<p>【解説 / Eloquent Model】</p>
<ul>
<li>Eloquent Model は Laravel 標準の ORM（object-relational mapper）である．</li>
<li>ORM とは，DB のレコードをオブジェクトとして直感的に扱えるようにしたもので，SQL を意識せずにプログラムで処理を記述することができる．</li>
<li>Eloquent Model は定義された「Model」を用いることで簡単に DB へのデータ保存・取得などを行える．</li>
<li>1 つのモデルが 1 つのテーブルに対応する．例えば，<code>tweets</code>テーブルに対して<code>Tweet</code>のようにモデルを定義すると自動的に対応する．モデル内に明示的に対応を記述することもできる．</li>
<li>テーブルに対してデータ操作を行う場合，対応するモデルに対して処理を実行することで DB 操作を行うことができる．</li>
</ul>
</blockquote>
<p>Model とマイグレーションファイルは一度に両方とも作成することができる．</p>
<p>下記コマンドは Model を作成するコマンドだが（<code>Tweet</code>がモデル名），<code>-m</code>をつけることでマイグレーションファイルも同時に作成できる．この手法を用いることで，Model 名とマイグレーションファイル内のテーブル名が自動的に対応する．</p>
<p>早速実行．</p>
<pre><code class="language-bash">$ php artisan make:model Tweet -m

# 実行結果（日付時刻は毎回変わる）
Model created successfully.
Created Migration: 2021_09_23_130915_create_tweets_table

</code></pre>
<p><code>database/migration/2021_09_23_130915_create_tweets_table.php</code>を開く．これがマイグレーションファイルである．</p>
<p>カラムを追加するため，下記にように編集する．今回は<code>tweet</code>，<code>description</code>の 2 カラムを追加する．</p>
<p>カラムを追加するときはデータ型も設定する．<code>tweet</code>は文字列（<code>string</code>），<code>description</code>はテキスト（<code>text</code>）を設定している．</p>
<p><code>id</code>ははじめから用意されているので設定不要．</p>
<blockquote>
<p>【tips】</p>
<ul>
<li><code>nullable()</code>を記述することで，入力必須でなくすることができる．他に<code>unique()</code>で重複を禁止することもできる．</li>
<li><code>timestamps()</code>は<code>created_at</code>カラムと<code>updated_at</code>カラムを自動的に設定してくれる．</li>
</ul>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_23_130915_create_tweets_table.php

&lt;?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class CreateTweetsTable extends Migration
{
  /**
   * Run the migrations.
   *
   * @return void
   */
  public function up()
  {
    Schema::create('tweets', function (Blueprint $table) {
      $table-&gt;id();
      // 🔽 ここから追加
      $table-&gt;string('tweet');
      $table-&gt;text('description')-&gt;nullable();
      // 🔼 ここまで追加
      $table-&gt;timestamps();
    });
  }

  /**
   * Reverse the migrations.
   *
   * @return void
   */
  public function down()
  {
    Schema::dropIfExists('tweets');
  }
}

</code></pre>
<!-- ## 【今回は不要】文字列最大長の変更

これでテーブルの設計は完了だが，MySQL のバージョンによってはエラーが発生するため，次の設定を行う．

`app/Providers/AppServiceProvider.php`の内容を以下のように編集する．`string`型の最大長を 191 に変更する．

> 【解説】
>
> - この設定が必要かどうかは MySQL のバージョンによる．MySQL のバージョンが`5.7.7`以下の場合は必要となる．
> - Laravel のマイグレーションでは文字列の最大長が`255`として実行するが，MySQL5.7.7 以下では最大長が`191`となっているためである．

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
// 🔽  1行追加
use Illuminate\Support\Facades\Schema;

class AppServiceProvider extends ServiceProvider
{
  /**
   * Register any application services.
   *
   * @return void
   */
  public function register()
  {
    //
  }

  /**
   * Bootstrap any application services.
   *
   * @return void
   */
  public function boot()
  {
    // 1行追加
    Schema::defaultStringLength(191);
  }
}
``` -->
<h2 id="マイグレーション実行"><a class="header" href="#マイグレーション実行">マイグレーション実行</a></h2>
<!-- > 📦 **Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<p>マイグレーションを実行するとテーブルが作成される．以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migration table created successfully.
Migrating: 2014_10_12_000000_create_users_table
Migrated:  2014_10_12_000000_create_users_table (88.55ms)
Migrating: 2014_10_12_100000_create_password_resets_table
Migrated:  2014_10_12_100000_create_password_resets_table (90.49ms)
Migrating: 2019_08_19_000000_create_failed_jobs_table
Migrated:  2019_08_19_000000_create_failed_jobs_table (89.10ms)
Migrating: 2019_12_14_000001_create_personal_access_tokens_table
Migrated:  2019_12_14_000001_create_personal_access_tokens_table (155.49ms)
Migrating: 2021_09_23_130915_create_tweets_table
Migrated:  2021_09_23_130915_create_tweets_table (57.06ms)

</code></pre>
<p>エラーになる場合はマイグレーションファイルの内容が間違っていることが多い．修正して以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate:fresh
</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>:fresh</code>をつけることで，存在しているテーブルを一旦削除し，再度マイグレーションを実行することができる．</li>
<li>マイグレーションに失敗した場合はエラーが発生するまでに実行された部分はテーブルが作成される．しかし，マイグレーション実行時に，すでに同名のテーブルが存在している場合はエラーになるため，既存テーブルを削除する必要がある．</li>
</ul>
</blockquote>
<h2 id="テーブル確認"><a class="header" href="#テーブル確認">テーブル確認</a></h2>
<p>phpmyadmin でテーブルの状況を確認する．<code>tweets</code>が以下の内容で作成されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

うまくいったら，mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.00 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.00 sec)

mysql> exit
Bye

``` -->
<h2 id="テストユーザーデータの作成"><a class="header" href="#テストユーザーデータの作成">テストユーザーデータの作成</a></h2>
<!-- > 📦 **Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<p>この段階で，ユーザテーブルなどの認証に使用するテーブルも用意された状態となる．</p>
<p>Laravel には「seeder」という機能があり，テスト用のデータを簡単に作成することができる．</p>
<p>今回はダミーデータを 10 件作成する．<code>database/seeders/DatabaseSeeder.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// database/seeders/DatabaseSeeder.php

&lt;?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
  /**
   * Seed the application's database.
   *
   * @return void
   */
  public function run()
  {
    // 🔽 この行のコメントから外す
    \App\Models\User::factory(10)-&gt;create();
  }
}

</code></pre>
<p>下記コマンドを実行してテストユーザを作成する．</p>
<pre><code class="language-bash">$ php artisan db:seed

# 実行結果
Database seeding completed successfully.

</code></pre>
<p>コマンドを実行したら phpmyadmin でユーザーデータを確認する．パスワードはハッシュ化されているが全員<code>password</code>となっている．</p>
<p>ブラウザの画面からメールアドレスとパスワードでログインできることを確認しよう．</p>
<p>ログインすると，下記の画面が表示される．</p>
<p><img src="laravel/laravel01/./img/register-success.png" alt="ユーザ登録完了" /></p>
<blockquote>
<p>【tips】</p>
<p><code>Email</code> は <code>example.com</code> が使用されている．これはテスト用に用意されているドメインであり，誰かのメールアドレスを使用してしまうリスクを回避できる．</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="ルーティングとコントローラ"><a class="header" href="#ルーティングとコントローラ">ルーティングとコントローラ</a></h1>
<p>Laravel では，クライアントからリクエストされた URL に対して，どの関数を実行するかを決める．この対応を決定するのが「ルーティング」であり，実際に実行される関数を記述するのが「コントローラ」である．</p>
<h2 id="ルーティングとコントローラの作成"><a class="header" href="#ルーティングとコントローラの作成">ルーティングとコントローラの作成</a></h2>
<!-- > 📦 **Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<p>コントローラとルーティングを作成する．今回のコントローラ名は<code>TweetController</code>とする．</p>
<p><code>--resource</code>をつけることで，よく使用する処理（代表的な CRUD 処理）を一括して作成することができる．</p>
<p>下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller TweetController --resource

# 実行結果
Controller created successfully.

</code></pre>
<p>これでコントローラファイルが作成された．続いてルーティングを作成する．</p>
<p><strong>ルーティングファイルは<code>routes</code>以下に配置される．</strong></p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
// 🔽 追加
use App\Http\Controllers\TweetController;

/*
|--------------------------------------------------------------------------
| Web Routes
|--------------------------------------------------------------------------
|
| Here is where you can register web routes for your application. These
| routes are loaded by the RouteServiceProvider within a group which
| contains the &quot;web&quot; middleware group. Now create something great!
|
*/

// 🔽 追加
Route::resource('tweet', TweetController::class);

Route::get('/', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__.'/auth.php';

</code></pre>
<p>ルーティングの一覧は下記で確認できる．</p>
<pre><code class="language-bash">$ php artisan route:list

# 実行結果（ユーザ操作などのルーティングは省略）
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+

</code></pre>
<blockquote>
<p>【解説】</p>
<p><strong>この表は非常に重要．</strong></p>
<ul>
<li>例えば，<code>/tweet/</code>に<code>GET</code>でリクエストが来た場合，<code>TweetController</code>の<code>index</code>関数が動作することを示している．</li>
<li>このように，URL と動作する関数の対応を決めているのがルーティングである．</li>
</ul>
</blockquote>
<p>これで，ルーティング部分は完了である．</p>
<h2 id="コントローラの実装一部"><a class="header" href="#コントローラの実装一部">コントローラの実装（一部）</a></h2>
<p>URL にリクエストが来た場合に実行される関数はコントローラに記述される．まずはリクエストが来た場合に特定の画面を表示するよう処理を記述する．</p>
<p><strong>コントローラは<code>app/Http/Controllers</code>以下に配置される．</strong></p>
<p><code>app/Http/Controllers/TweetController.php</code>の内容を以下のように編集する．</p>
<p><code>view()</code>関数は指定したビューファイル（画面）を表示する．<code>tweet.index</code>は<code>tweet</code>フォルダの<code>index.blade.php</code>の意味．ビューファイルは次項で作成する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
// 🔽 2行追加
use Validator;
use App\Models\Tweet;

class TweetController extends Controller
{
  /**
   * Display a listing of the resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function index()
  {
    // 🔽 追加
    return view('tweet.index');
  }

  /**
   * Show the form for creating a new resource.
   *
   * @return \Illuminate\Http\Response
   */
  public function create()
  {
    // 🔽 追加
    return view('tweet.create');
  }

  // 以降は変更なし

}

</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="必要な画面の作成と動作確認"><a class="header" href="#必要な画面の作成と動作確認">必要な画面の作成と動作確認</a></h1>
<h2 id="共通画面の作成"><a class="header" href="#共通画面の作成">共通画面の作成</a></h2>
<p>実際にブラウザ画面に表示される内容を記述する．ビューファイルは<code>*.blade.php</code>の形式で作成する．これは「blade テンプレート」と呼ばれる形式であり，コントローラとのデータのやり取りなどに最適化されている．</p>
<p><strong>ビューファイルは<code>latavel_tweet/resources/views</code>ディレクトリ以下に配置する．</strong></p>
<p>blade テンプレートでは共通パーツと個別パーツを組み合わせて画面を構成する．例えば，アプリケーション全体を通して表示されるナビゲーションバーやエラー画面などは共通パーツである．</p>
<p>それぞれのパーツは「コンポーネント」と呼ばれる．</p>
<h2 id="共通パーツエラー表示の作成"><a class="header" href="#共通パーツエラー表示の作成">共通パーツ（エラー表示）の作成</a></h2>
<p>入力値が不正な場合などはエラー画面を表示して対応する．</p>
<p>tweet の入力や編集など複数の画面で必要となるため，共通のコンポーネントとして作成する．</p>
<p><code>latavel_tweet/resources/views</code>の中に<code>common</code>ディレクトリを作成する．
<code>common</code>ディレクトリの中に<code>errors.blade.php</code>ファイルを作成する．</p>
<p><code>errors.blade.php</code>に以下の内容を記述する．</p>
<pre><code class="language-php">@if (count($errors) &gt; 0)
&lt;div&gt;
  &lt;div class=&quot;font-medium text-red-600&quot;&gt;
    {{ __('Whoops! Something went wrong.') }}
  &lt;/div&gt;

  &lt;ul class=&quot;mt-3 list-disc list-inside text-sm text-red-600&quot;&gt;
    @foreach ($errors-&gt;all() as $error)
    &lt;li&gt;{{ $error }}&lt;/li&gt;
    @endforeach
  &lt;/ul&gt;
&lt;/div&gt;
@endif

</code></pre>
<h2 id="共通パーツナビゲーションバーの調整"><a class="header" href="#共通パーツナビゲーションバーの調整">共通パーツ（ナビゲーションバー）の調整</a></h2>
<p>ナビゲーションバーもアプリケーションを通じて使用するため，共通パーツとして作成する．</p>
<p>「tweet 一覧」と「tweet 作成」の 2 種類のリンクを作成しておく．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>全部で 4 箇所追記があるので注意．長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>Laravel8 のビューは CSS フレームワークの<code>tailwind.css</code>を使用している．</li>
<li>予め用意されたクラス名を記述するだけでスタイルを適用できるので，ドキュメントを読みながらスタイルを変更してみよう．</li>
</ul>
</blockquote>
<p>画面をリロードすると下記のようにナビゲーションが設置された状態となる（一覧ページと作成ページはまだ作成していないので動作しない点に注意）．</p>
<p><img src="laravel/laravel01/./img/laratter_logged_in.png" alt="ナビゲーション設置" /></p>
<h2 id="tweet-作成画面の作成"><a class="header" href="#tweet-作成画面の作成">tweet 作成画面の作成</a></h2>
<p>まず，<code>resources/views</code>の中に<code>tweet</code>ディレクトリを作成する．</p>
<p>続いて，<code>tweet</code>ディレクトリの中に以下のファイルを作成する．今後必要になる画面のファイルも合わせて作成している．</p>
<ul>
<li><code>index.blade.php</code>（tweet 一覧画面）</li>
<li><code>create.blade.php</code>（tweet 作成画面）</li>
<li><code>show.blade.php</code>（tweet 詳細画面）</li>
<li><code>edit.blade.php</code>（tweet 編集画面）</li>
</ul>
<p>ファイルを作成したら<code>create.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/create.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Create New Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.store') }}&quot; method=&quot;POST&quot;&gt;
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;Tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot;&gt;
            &lt;/div&gt;
            &lt;button type=&quot;submit&quot; class=&quot;w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Create
            &lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>route('tweet.store')</code>は<code>TweetController</code>の<code>store()</code>関数にデータを送ることを示している．</li>
<li><code>@csrf</code>はセキュリティ対策．フォームからデータを送信するときには必ず記述すること．</li>
</ul>
</blockquote>
<h2 id="動作確認作成画面"><a class="header" href="#動作確認作成画面">動作確認（作成画面）</a></h2>
<p>編集したらブラウザから<code>localhost/tweet/create</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_create.png" alt="tweet作成画面" /></p>
<h2 id="tweet-一覧画面の作成"><a class="header" href="#tweet-一覧画面の作成">tweet 一覧画面の作成</a></h2>
<p>続いて，<code>index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<p>こちらはエラーが発生する．</p>
<p><img src="laravel/laravel01/./img/laratter_index_error.png" alt="一覧画面のエラー" /></p>
<p>コントローラから<code>$tweets</code>という名前でデータを受け取るよう記述しているが，コントローラからデータが送られていないためである．</p>
<p>とりあえず空のデータを送るように<code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>view()</code>関数の第 2 引数に渡したいデータを配列で記述する．</li>
<li>ここでは「<code>tweets</code>」という名前で「空の配列」を送っている．</li>
<li>ビューファイル側では<code>$tweets</code>とすることで渡されたデータを使うことができる．</li>
<li>また，変数などのデータは<code>var_dump()</code>または<code>dd()</code>または<code>ddd()</code>で確認することができる．これらを使ってデータの構造を確認しながら進めると良いだろう．</li>
</ul>
</blockquote>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // 🔽 編集
  return view('tweet.index', [
    'tweets' =&gt; []
  ]);
}

</code></pre>
<h2 id="動作確認"><a class="header" href="#動作確認">動作確認</a></h2>
<p>編集したらブラウザから<code>localhost/tweet</code>にアクセスして動作確認．
下記画面になっていれば OK．</p>
<p><img src="laravel/laravel01/./img/laratter_index_empty.png" alt="一覧画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-作成処理の実装"><a class="header" href="#tweet-作成処理の実装">tweet 作成処理の実装</a></h1>
<p>必要な画面を揃えたので，作成ページから実際に DB にデータを保存できるようにする．</p>
<h2 id="model-の編集"><a class="header" href="#model-の編集">Model の編集</a></h2>
<p>Model の役割は「DB とのデータをやり取り」である．Model には DB からどのようにデータを取得するか，などの処理を記述する．</p>
<p>ただし，Model には予め使用頻度の高い処理（基本的な CRUD）が用意されているため，今回記述するコードはそれほど多くない．</p>
<p>まず，テーブル対して，Laravel 側からデータの作成や編集が行えないカラムを設定する．</p>
<p>これはクライアントから送信されてくるデータが ID やユーザ権限などの情報を書き換えてしまうリスクを低減させるためである．</p>
<p><code>app/Models/Tweet.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // アプリケーション側でcreateなどできない値を記述する
  // 🔽 以下の処理を記述

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];
}


</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$guarded</code>はアプリケーション側から変更できないカラムを指定する（ブラックリスト）．</li>
<li>対して，<code>$fillable</code>はアプリケーション側から変更できるカラムを指定する（ホワイトリスト）．</li>
<li>どちらを使用しても良いが，どちらかを使用する必要がある．</li>
</ul>
</blockquote>
<h2 id="controller-の編集"><a class="header" href="#controller-の編集">Controller の編集</a></h2>
<p>続いて，コントローラに「Model に対しての命令」を記述する．DB とやり取りする関数はすでに定義されているのでモデル側に新たな記述は必要ない．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function store(Request $request)
{
  // バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  // バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.create')
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  // create()は最初から用意されている関数
  // 戻り値は挿入されたレコードの情報
  $result = Tweet::create($request-&gt;all());
  // ルーティング「todo.index」にリクエスト送信（一覧ページに移動）
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>create.blade.php</code>から送信されていたデータは<code>$request</code>に入っている．<code>$request-&gt;all()</code>とすることで全部取得することができる．</li>
<li><code>redirect()-&gt;route('tweet.index')</code>は指定したコントローラの関数を動かす．今回は<code>TweetController</code>の<code>index()</code>関数．</li>
</ul>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-一覧画面の実装"><a class="header" href="#tweet-一覧画面の実装">tweet 一覧画面の実装</a></h1>
<p>一覧画面では締切が早い順にソートしてデータを表示する．</p>
<h3 id="model-の処理"><a class="header" href="#model-の処理">Model の処理</a></h3>
<p>まず，上記の条件でデータを取得する関数を Model に作成する．</p>
<p><code>app/Models/Tweet.php</code>に以下の関数を作成する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  // 🔽 追加
  public static function getAllOrderByUpdated_at()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>self</code>は Tweet モデルのこと．</li>
<li><code>orderBy()</code>は SQL のものと同じ理解で OK．</li>
<li>最後の<code>get()</code>がないと実行されないので注意．</li>
</ul>
</blockquote>
<h2 id="controller-を編集"><a class="header" href="#controller-を編集">Controller を編集</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function index()
{
  // 🔽 編集
  $tweets = Tweet::getAllOrderByUpdated_at();
  return view('tweet.index', [
    'tweets' =&gt; $tweets
  ]);
}

</code></pre>
<h2 id="動作確認-1"><a class="header" href="#動作確認-1">動作確認</a></h2>
<p>tweet 作成画面でデータを入力して送信すると．．．</p>
<p><img src="laravel/laravel01/./img/laratter_create_adding.png" alt="データ作成" /></p>
<p>自動的に一覧画面に切り替わる．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_one.png" alt="データ1件追加" /></p>
<p>自分が入力したデータが表示されていれば OK．何件かデータを入れておこう．</p>
<p><img src="laravel/laravel01/./img/laratter_index_added_some.png" alt="データ複数件追加" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-02"><a class="header" href="#laravel-02">Laravel 02</a></h1>
<h2 id="本日の内容-1"><a class="header" href="#本日の内容-1">本日の内容</a></h2>
<ul>
<li>SNS アプリケーションの実装（詳細表示，更新処理，削除処理）</li>
<li>ユーザ情報の利用</li>
</ul>
<h2 id="本日の目標-1"><a class="header" href="#本日の目標-1">本日の目標</a></h2>
<ul>
<li>CRUD 処理の流れをマスターする．</li>
<li>ユーザ情報の取得や取得したデータの使い方を学ぶ．</li>
<li>データを連携させる処理を実装する．</li>
</ul>
<h2 id="ルーティング表-1"><a class="header" href="#ルーティング表-1">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドなどまとめ-2"><a class="header" href="#多用するコマンドなどまとめ-2">多用するコマンドなどまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="laravel-アプリケーションの立ち上げ-2"><a class="header" href="#laravel-アプリケーションの立ち上げ-2">Laravel アプリケーションの立ち上げ</a></h3>
<pre><code class="language-bash">$ php artisan serve
</code></pre>
<h3 id="laravel-アプリケーション画面の確認-2"><a class="header" href="#laravel-アプリケーション画面の確認-2">Laravel アプリケーション画面の確認</a></h3>
<p>上記コマンド実行後，左側の「8080」をクリック．</p>
<h3 id="phpmyadmin-画面の確認-2"><a class="header" href="#phpmyadmin-画面の確認-2">phpmyadmin 画面の確認</a></h3>
<p>左側の「80」をクリックし，表示された画面の URL の後に <code>/phpmyadmin</code> を追加．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-詳細画面の実装"><a class="header" href="#tweet-詳細画面の実装">tweet 詳細画面の実装</a></h1>
<p>詳細画面は tweet の 1 件を個別に表示する．</p>
<h2 id="一覧画面に詳細画面へのリンクを作成"><a class="header" href="#一覧画面に詳細画面へのリンクを作成">一覧画面に詳細画面へのリンクを作成</a></h2>
<p>各 tweet の詳細を取得する処理と表示する画面を作成する．</p>
<p>一覧画面の tweet 名をクリックすると詳細画面に移動するようにする．</p>
<p>クリックするとコントローラの<code>show()</code>関数にリクエストを送るように記述している．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;!-- 🔽 詳細画面へのリンク --&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 削除ボタン --&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="指定した-1-件のデータを取得する処理を追加"><a class="header" href="#指定した-1-件のデータを取得する処理を追加">指定した 1 件のデータを取得する処理を追加</a></h2>
<p><code>show()</code>関数では，ID を指定して 1 件のデータを取得したい．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>show()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function show($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.show', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>ここでは，受け取った ID の値でテーブルからデータを取り出し，<code>tweet</code>という名前で<code>show.blade.php</code>に渡している．</p>
<h2 id="詳細表示画面の作成"><a class="header" href="#詳細表示画面の作成">詳細表示画面の作成</a></h2>
<p>詳細画面の<code>resources/views/tweet/show.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/show.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Show Tweet Detail') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;div class=&quot;mb-6&quot;&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Tweet&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;tweet&quot;&gt;
                {{$tweet-&gt;tweet}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;p class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot;&gt;Description&lt;/p&gt;
              &lt;p class=&quot;py-2 px-3 text-grey-darkest&quot; id=&quot;description&quot;&gt;
                {{$tweet-&gt;description}}
              &lt;/p&gt;
            &lt;/div&gt;
            &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-full py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
              Back
            &lt;/a&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-2"><a class="header" href="#動作確認-2">動作確認</a></h2>
<p>一覧画面で各 tweet をクリックし，下記のように詳細画面が表示されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_show.png" alt="詳細画面" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-削除処理の実装"><a class="header" href="#tweet-削除処理の実装">tweet 削除処理の実装</a></h1>
<p>一覧画面に削除ボタンを設置し，クリックしたら該当するデータを削除できるようにする．</p>
<h2 id="一覧画面に削除ボタンを追加"><a class="header" href="#一覧画面に削除ボタンを追加">一覧画面に削除ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 更新ボタン --&gt;
                    &lt;!-- 🔽 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li>削除ボタンクリック時には，コントローラの<code>destroy()</code>関数にリクエストが送られる．</li>
<li>削除の処理を行うには<code>DELETE</code>メソッドでリクエストを送る必要があるが，form からは GET または POST でしか送れない．</li>
<li><code>@method('delete')</code>を記述することで，<code>DELETE</code>メソッドで送信できる．</li>
</ul>
</blockquote>
<h2 id="動作確認削除ボタンの設置"><a class="header" href="#動作確認削除ボタンの設置">動作確認（削除ボタンの設置）</a></h2>
<p>一覧画面を確認し，削除ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_delete_button.png" alt="削除ボタン追加" /></p>
<h2 id="指定したデータを削除する処理の作成"><a class="header" href="#指定したデータを削除する処理の作成">指定したデータを削除する処理の作成</a></h2>
<p>まず ID で指定したデータを 1 件抽出し，そのデータを削除する，という流れ．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>destroy()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function destroy($id)
{
  $result = Tweet::find($id)-&gt;delete();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認削除処理"><a class="header" href="#動作確認削除処理">動作確認（削除処理）</a></h2>
<p>動作させて確認する．削除ボタンをクリックし，該当するデータが削除されれば OK．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-更新処理の実装"><a class="header" href="#tweet-更新処理の実装">tweet 更新処理の実装</a></h1>
<p>更新処理は</p>
<ol>
<li>一覧画面に編集ボタンを設置．</li>
<li>編集ボタンをクリックしたら編集画面に移動.</li>
<li>編集画面でデータを書き換え，送信ボタンクリックで DB のデータを更新する．</li>
</ol>
<h2 id="一覧画面に編集ボタンを追加"><a class="header" href="#一覧画面に編集ボタンを追加">一覧画面に編集ボタンを追加</a></h2>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集ボタンの設置"><a class="header" href="#動作確認編集ボタンの設置">動作確認（編集ボタンの設置）</a></h2>
<p>一覧画面に編集ボタンが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_added_edit_button.png" alt="編集ボタン追加" /></p>
<h2 id="編集画面に移動する処理の作成"><a class="header" href="#編集画面に移動する処理の作成">編集画面に移動する処理の作成</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>edit()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controller/TweetController.php

public function edit($id)
{
  $tweet = Tweet::find($id);
  return view('tweet.edit', ['tweet' =&gt; $tweet]);
}

</code></pre>
<p>やっていることは<code>create()</code>関数と同様．</p>
<h2 id="編集画面の作成"><a class="header" href="#編集画面の作成">編集画面の作成</a></h2>
<p><code>resources/views/tweet/edit.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/edit.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Edit Tweet') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-8/12 md:w-1/2 lg:w-5/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          @include('common.errors')
          &lt;form class=&quot;mb-6&quot; action=&quot;{{ route('tweet.update',$tweet-&gt;id) }}&quot; method=&quot;POST&quot;&gt;
            @method('put')
            @csrf
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;tweet&quot;&gt;tweet&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;tweet&quot; id=&quot;tweet&quot; value=&quot;{{$tweet-&gt;tweet}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex flex-col mb-4&quot;&gt;
              &lt;label class=&quot;mb-2 uppercase font-bold text-lg text-grey-darkest&quot; for=&quot;description&quot;&gt;Description&lt;/label&gt;
              &lt;input class=&quot;border py-2 px-3 text-grey-darkest&quot; type=&quot;text&quot; name=&quot;description&quot; id=&quot;description&quot; value=&quot;{{$tweet-&gt;description}}&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;flex justify-evenly&quot;&gt;
              &lt;a href=&quot;{{ route('tweet.index') }}&quot; class=&quot;block text-center w-5/12 py-3 mt-6 font-medium tracking-widest text-black uppercase bg-gray-100 shadow-sm focus:outline-none hover:bg-gray-200 hover:shadow-none&quot;&gt;
                Back
              &lt;/a&gt;
              &lt;button type=&quot;submit&quot; class=&quot;w-5/12 py-3 mt-6 font-medium tracking-widest text-white uppercase bg-black shadow-lg focus:outline-none hover:bg-gray-900 hover:shadow-none&quot;&gt;
                Update
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集画面"><a class="header" href="#動作確認編集画面">動作確認（編集画面）</a></h2>
<p>一覧画面の編集ボタンをクリックし，現在のデータが表示されていれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_edit.png" alt="編集画面" /></p>
<h2 id="指定したデータを更新する処理の作成"><a class="header" href="#指定したデータを更新する処理の作成">指定したデータを更新する処理の作成</a></h2>
<p>編集画面でデータを書き換え，コントローラの<code>update()</code>関数にデータを送信し，DB のデータを更新する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>update()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

public function update(Request $request, $id)
{
  //バリデーション
  $validator = Validator::make($request-&gt;all(), [
    'tweet' =&gt; 'required | max:191',
    'description' =&gt; 'required',
  ]);
  //バリデーション:エラー
  if ($validator-&gt;fails()) {
    return redirect()
      -&gt;route('tweet.edit', $id)
      -&gt;withInput()
      -&gt;withErrors($validator);
  }
  //データ更新処理
  // updateは更新する情報がなくても更新が走る（updated_atが更新される）
  $result = Tweet::find($id)-&gt;update($request-&gt;all());
  // fill()save()は更新する情報がない場合は更新が走らない（updated_atが更新されない）
  // $redult = Tweet::find($id)-&gt;fill($request-&gt;all())-&gt;save();
  return redirect()-&gt;route('tweet.index');
}

</code></pre>
<h2 id="動作確認更新処理"><a class="header" href="#動作確認更新処理">動作確認（更新処理）</a></h2>
<p>一覧画面のデータが，編集画面で書き換えたデータに更新されれば OK．</p>
<p><img src="laravel/laravel02/./img/laratter_index_updated.png" alt="データ更新結果" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="tweet-とユーザ認証の連携"><a class="header" href="#tweet-とユーザ認証の連携">tweet とユーザ認証の連携</a></h1>
<p>はじめのほうで，ユーザ認証を行う breeze ライブラリをインストールしたため，これを利用してユーザ管理を行う．</p>
<p>まず，認証ユーザのみがアプリケーションの機能を利用できるように処理を変更する．現状ではログインしていない状態でも一覧画面などにアクセスできてしまう（実際はユーザ情報が不足しているためエラー画面となる）．</p>
<h2 id="ログインしていないユーザはアプリケーションにアクセスできないようにする"><a class="header" href="#ログインしていないユーザはアプリケーションにアクセスできないようにする">ログインしていないユーザはアプリケーションにアクセスできないようにする．</a></h2>
<p><code>app/routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// app/routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// コメントは省略

// 🔽 ここを編集
Route::group(['middleware' =&gt; 'auth'], function () {
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="動作確認ログイン必須"><a class="header" href="#動作確認ログイン必須">動作確認（ログイン必須）</a></h2>
<p>一旦ログアウトした状態で，URL 直打ち（<code>localhost/tweet</code>）して tweet 画面にアクセスできずにログイン画面に戻されれば OK！</p>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>['middleware' =&gt; 'auth']</code> を記述することで認証状態をチェックしてくれる．</li>
<li><code>{}</code> 内に記述したルーティングは認証必須となり，未認証（未ログイン）の場合はログイン画面に戻される．</li>
</ul>
</blockquote>
<h2 id="tweet-テーブルにユーザ-id-カラムを追加する"><a class="header" href="#tweet-テーブルにユーザ-id-カラムを追加する">tweet テーブルにユーザ ID カラムを追加する</a></h2>
<!-- > 📦 **Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<h3 id="マイグレーションファイルの作成"><a class="header" href="#マイグレーションファイルの作成">マイグレーションファイルの作成</a></h3>
<p>カラムの変更はマイグレーションで行う．</p>
<blockquote>
<ul>
<li>本来はカラムはテーブル作成時点で決定しておくことが望ましい．</li>
<li>マイグレーションは実行した内容を取り消せる（ロールバック）ため，不具合が生じても対応できる場合が多い．</li>
</ul>
</blockquote>
<p>下記コマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:migration add_user_id_to_tweets_table --table=tweets

# 実行結果
Created Migration: 2021_09_24_061716_add_user_id_to_tweets_table

</code></pre>
<h3 id="マイグレーションファイルの編集"><a class="header" href="#マイグレーションファイルの編集">マイグレーションファイルの編集</a></h3>
<p><code>database/migration/2021_09_24_061716_add_user_id_to_tweets_table.php</code>を開く．
下記にように編集する．</p>
<blockquote>
<p>他のテーブルと relation させるためには，カラム名を「<code>モデル名小文字_id</code>」とする必要がある．</p>
</blockquote>
<pre><code class="language-php">// database/migrations/2021_09_24_061716_add_user_id_to_tweets_table.php

public function up()
{
  Schema::table('tweets', function (Blueprint $table) {
    // 🔽 1行追加
    $table-&gt;integer('user_id')-&gt;after('id');
  });
}

</code></pre>
<h3 id="マイグレーション実行-1"><a class="header" href="#マイグレーション実行-1">マイグレーション実行</a></h3>
<p>以下のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_061716_add_user_id_to_tweets_table
Migrated:  2021_09_24_061716_add_user_id_to_tweets_table (102.98ms)

</code></pre>
<h2 id="テーブルの確認"><a class="header" href="#テーブルの確認">テーブルの確認</a></h2>
<p>phpmyadmin でテーブルの構造を確認する．<code>user_id</code> カラムが追加されていれば OK．</p>
<pre><code class="language-txt">+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】コマンドで確認する場合は以下の手順で行う．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

mysql にログインしてテーブルを確認する．パスワードは`password`．

```bash
$ mysql -u sail -p

mysql> use laratter
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweets                 |
| users                  |
+------------------------+
6 rows in set (0.01 sec)

mysql> desc tweets;
+-------------+-----------------+------+-----+---------+----------------+
| Field       | Type            | Null | Key | Default | Extra          |
+-------------+-----------------+------+-----+---------+----------------+
| id          | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id     | int             | NO   |     | NULL    |                |
| tweet       | varchar(191)    | NO   |     | NULL    |                |
| description | text            | YES  |     | NULL    |                |
| created_at  | timestamp       | YES  |     | NULL    |                |
| updated_at  | timestamp       | YES  |     | NULL    |                |
+-------------+-----------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql>

``` -->
<h2 id="データ追加時に-user_id-を追加"><a class="header" href="#データ追加時に-user_id-を追加">データ追加時に user_id を追加</a></h2>
<p>tweet のデータを作成する際に，「誰が作成したのか」がわかるように，データにログインユーザの ID を追加する．</p>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>store()</code>を内容を以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use Validator;
use App\Models\Tweet;

// 🔽 追加
use Auth;

class TweetController extends Controller
{

  // 省略

  public function store(Request $request)
  {
    // バリデーション
    $validator = Validator::make($request-&gt;all(), [
      'tweet' =&gt; 'required | max:191',
      'description' =&gt; 'required',
    ]);
    // バリデーション:エラー
    if ($validator-&gt;fails()) {
      return redirect()
        -&gt;route('tweet.create')
        -&gt;withInput()
        -&gt;withErrors($validator);
    }

    // 🔽 編集 フォームから送信されてきたデータとユーザIDをマージし，DBにinsertする
    $data = $request-&gt;merge(['user_id' =&gt; Auth::user()-&gt;id])-&gt;all();
    $result = Tweet::create($data);

    // tweet.index」にリクエスト送信（一覧ページに移動）
    return redirect()-&gt;route('tweet.index');
  }

  // 省略
}

</code></pre>
<blockquote>
<p>【解説】</p>
<ul>
<li><code>$request-&gt;merge()</code>でユーザ ID を追加している．</li>
<li><code>Auth::user()-&gt;id</code>で現在ログインしているユーザの ID を取得することができる（<code>Auth::id()</code>でも可）．</li>
<li><code>Auth::user()</code>には他にもデータが入っているので，<code>dd()</code>などで確認してみると良いだろう．</li>
</ul>
</blockquote>
<h2 id="動作確認-3"><a class="header" href="#動作確認-3">動作確認</a></h2>
<p>適当なデータを追加し，phpmyadmin で確認する．</p>
<p>tweets テーブルのデータにユーザ ID が一緒に入っていれば OK．既存データの user_id カラムに 0 が入っているので，ログインユーザの ID に変更しておこう．</p>
<blockquote>
<p><strong>💡【注意】</strong></p>
<p><code>user_id</code> カラムに 1 つでも <code>0</code> が入っているとエラーになってしまうので，必ず「ユーザテーブルに存在する id の数値」を入れておくこと！</p>
</blockquote>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="laravel-03"><a class="header" href="#laravel-03">Laravel 03</a></h1>
<h2 id="本日の内容-2"><a class="header" href="#本日の内容-2">本日の内容</a></h2>
<ul>
<li>マイページの実装（1 対多のデータ）．</li>
<li>ユーザ名の表示（多対 1 のデータ）．</li>
<li>favorite 機能の実装（多対多）．</li>
</ul>
<h2 id="本日の目標-2"><a class="header" href="#本日の目標-2">本日の目標</a></h2>
<ul>
<li>SNS アプリケーションを完成させる．</li>
<li>様々な形のデータを扱う方法を学ぶ．</li>
<li>Laravel でアプリケーションを開発するイメージを持つ．</li>
</ul>
<h2 id="ルーティング表-2"><a class="header" href="#ルーティング表-2">ルーティング表</a></h2>
<p>都度確認しよう！</p>
<pre><code class="language-txt">+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
| Domain | Method    | URI                   | Name           | Action                                              | Middleware      |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
|        | GET|HEAD  | tweet                 | tweet.index    | App\Http\Controllers\TweetController@index          | web             |
|        | POST      | tweet                 | tweet.store    | App\Http\Controllers\TweetController@store          | web             |
|        | GET|HEAD  | tweet/create          | tweet.create   | App\Http\Controllers\TweetController@create         | web             |
|        | GET|HEAD  | tweet/{tweet}         | tweet.show     | App\Http\Controllers\TweetController@show           | web             |
|        | PUT|PATCH | tweet/{tweet}         | tweet.update   | App\Http\Controllers\TweetController@update         | web             |
|        | DELETE    | tweet/{tweet}         | tweet.destroy  | App\Http\Controllers\TweetController@destroy        | web             |
|        | GET|HEAD  | tweet/{tweet}/edit    | tweet.edit     | App\Http\Controllers\TweetController@edit           | web             |
+--------+-----------+-----------------------+----------------+-----------------------------------------------------+-----------------+
</code></pre>
<h2 id="多用するコマンドなどまとめ-3"><a class="header" href="#多用するコマンドなどまとめ-3">多用するコマンドなどまとめ</a></h2>
<p>※ここでは実行しません！！ 開発中に忘れたら見よう！</p>
<h3 id="laravel-アプリケーションの立ち上げ-3"><a class="header" href="#laravel-アプリケーションの立ち上げ-3">Laravel アプリケーションの立ち上げ</a></h3>
<pre><code class="language-bash">$ php artisan serve
</code></pre>
<h3 id="laravel-アプリケーション画面の確認-3"><a class="header" href="#laravel-アプリケーション画面の確認-3">Laravel アプリケーション画面の確認</a></h3>
<p>上記コマンド実行後，左側の「8080」をクリック．</p>
<h3 id="phpmyadmin-画面の確認-3"><a class="header" href="#phpmyadmin-画面の確認-3">phpmyadmin 画面の確認</a></h3>
<p>左側の「80」をクリックし，表示された画面の URL の後に <code>/phpmyadmin</code> を追加．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="マイページ機能の実装1-対多のデータ"><a class="header" href="#マイページ機能の実装1-対多のデータ">マイページ機能の実装（1 対多のデータ）</a></h1>
<p>現在，一覧ページにはユーザ関係なく全てのデータが表示された状態となっている．ユーザが自分の投稿を確認して編集できるように，マイページ機能を実装する．</p>
<h2 id="1-対多のデータ連携"><a class="header" href="#1-対多のデータ連携">1 対多のデータ連携</a></h2>
<p>今回の場合，ユーザと tweet が「1 対多」の関係となっている．</p>
<p>Laravel では，このような場合に親となるデータから子のデータを取得する方法が準備されている．</p>
<p><code>app/Models/User.php</code>に以下のように編集する．</p>
<pre><code class="language-php">// app/Http/Models/User.php

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // 🔽 追加
  public function mytweets()
  {
    return $this-&gt;hasMany(Tweet::class)-&gt;orderBy('updated_at', 'desc');
  }
}

</code></pre>
<p>ここで，User と Tweet を連携させるためには，子（Tweet）のカラムに「<code>親_id</code>」（&lt;- 今回は<code>user_id</code>）を用意しておく必要がある（前項で実施）．</p>
<p>これで<code>User</code>モデルを用いて，特定のユーザが投稿した tweet を取得できるようになる．</p>
<h2 id="マイページのルーティング"><a class="header" href="#マイページのルーティング">マイページのルーティング</a></h2>
<p>マイページを表示するためのルーティングを追加する．</p>
<p><code>routes/web.php</code>を以下のように編集する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

Route::group(['middleware' =&gt; 'auth'], function () {
  // 🔽 追加
  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="特定ユーザのデータのみ取得する処理"><a class="header" href="#特定ユーザのデータのみ取得する処理">特定ユーザのデータのみ取得する処理</a></h2>
<p><code>app/Http/Controllers/TweetController.php</code>の<code>index()</code>を内容を以下のように編集する．</p>
<p><code>class TweetController extends Controller{ ... }</code>内の最後に<code>mydata()</code>関数を追加すれば OK．</p>
<pre><code class="language-php">// app/Http/Controllers/TweetController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Validator;
use App\Models\Tweet;
use Auth;

// 🔽 追加
use App\Models\User;

class TweetController extends Controller
{

  // 省略

  public function mydata()
  {
    // Userモデルに定義した関数を実行する．
    $tweets = User::find(Auth::user()-&gt;id)-&gt;mytweets;
    return view('tweet.index', [
      'tweets' =&gt; $tweets
    ]);
  }
}

</code></pre>
<h2 id="マイページ画面の確認"><a class="header" href="#マイページ画面の確認">マイページ画面の確認</a></h2>
<p>マイページ自体は<code>index.blade.php</code>画面をそのまま利用するため，新たに実装する必要はない（ビューファイルにログインユーザのデータのみ渡される）．</p>
<p>スムーズにマイページにアクセスできるようにするため，ナビゲーション部分にリンクを追加する．</p>
<p><code>resources/views/layouts/navigation.blade.php</code>の内容を以下のように編集する．</p>
<p>長いので全コピペ推奨．</p>
<pre><code class="language-php">&lt;!-- resources/views/layouts/navigation.blade.php --&gt;

&lt;nav x-data=&quot;{ open: false }&quot; class=&quot;bg-white border-b border-gray-100&quot;&gt;
  &lt;!-- Primary Navigation Menu --&gt;
  &lt;div class=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
    &lt;div class=&quot;flex justify-between h-16&quot;&gt;
      &lt;div class=&quot;flex&quot;&gt;
        &lt;!-- Logo --&gt;
        &lt;div class=&quot;flex-shrink-0 flex items-center&quot;&gt;
          &lt;a href=&quot;{{ route('dashboard') }}&quot;&gt;
            &lt;x-application-logo class=&quot;block h-10 w-auto fill-current text-gray-600&quot; /&gt;
          &lt;/a&gt;
        &lt;/div&gt;

        &lt;!-- Navigation Links --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
            {{ __('Dashboard') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
            {{ __('Index') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
            {{ __('Create') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
        &lt;!-- 🔽 マイページへのリンクを追加 --&gt;
        &lt;div class=&quot;hidden space-x-8 sm:-my-px sm:ml-10 sm:flex&quot;&gt;
          &lt;x-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
            {{ __('Mypage') }}
          &lt;/x-nav-link&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Settings Dropdown --&gt;
      &lt;div class=&quot;hidden sm:flex sm:items-center sm:ml-6&quot;&gt;
        &lt;x-dropdown align=&quot;right&quot; width=&quot;48&quot;&gt;
          &lt;x-slot name=&quot;trigger&quot;&gt;
            &lt;button class=&quot;flex items-center text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out&quot;&gt;
              &lt;div&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;

              &lt;div class=&quot;ml-1&quot;&gt;
                &lt;svg class=&quot;fill-current h-4 w-4&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                  &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z&quot; clip-rule=&quot;evenodd&quot; /&gt;
                &lt;/svg&gt;
              &lt;/div&gt;
            &lt;/button&gt;
          &lt;/x-slot&gt;

          &lt;x-slot name=&quot;content&quot;&gt;
            &lt;!-- Authentication --&gt;
            &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
              @csrf

              &lt;x-dropdown-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                                this.closest('form').submit();&quot;&gt;
                {{ __('Logout') }}
              &lt;/x-dropdown-link&gt;
            &lt;/form&gt;
          &lt;/x-slot&gt;
        &lt;/x-dropdown&gt;
      &lt;/div&gt;

      &lt;!-- Hamburger --&gt;
      &lt;div class=&quot;-mr-2 flex items-center sm:hidden&quot;&gt;
        &lt;button @click=&quot;open = ! open&quot; class=&quot;inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out&quot;&gt;
          &lt;svg class=&quot;h-6 w-6&quot; stroke=&quot;currentColor&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot;&gt;
            &lt;path :class=&quot;{'hidden': open, 'inline-flex': ! open }&quot; class=&quot;inline-flex&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M4 6h16M4 12h16M4 18h16&quot; /&gt;
            &lt;path :class=&quot;{'hidden': ! open, 'inline-flex': open }&quot; class=&quot;hidden&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M6 18L18 6M6 6l12 12&quot; /&gt;
          &lt;/svg&gt;
        &lt;/button&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;!-- Responsive Navigation Menu --&gt;
  &lt;div :class=&quot;{'block': open, 'hidden': ! open}&quot; class=&quot;hidden sm:hidden&quot;&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('dashboard')&quot; :active=&quot;request()-&gt;routeIs('dashboard')&quot;&gt;
        {{ __('Dashboard') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 一覧ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.index')&quot; :active=&quot;request()-&gt;routeIs('tweet.index')&quot;&gt;
        {{ __('Index') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 作成ページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.create')&quot; :active=&quot;request()-&gt;routeIs('tweet.create')&quot;&gt;
        {{ __('Create') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;
    &lt;!-- 🔽 マイページへのリンクを追加 --&gt;
    &lt;div class=&quot;pt-2 pb-3 space-y-1&quot;&gt;
      &lt;x-responsive-nav-link :href=&quot;route('tweet.mypage')&quot; :active=&quot;request()-&gt;routeIs('tweet.mypage')&quot;&gt;
        {{ __('Mypage') }}
      &lt;/x-responsive-nav-link&gt;
    &lt;/div&gt;

    &lt;!-- Responsive Settings Options --&gt;
    &lt;div class=&quot;pt-4 pb-1 border-t border-gray-200&quot;&gt;
      &lt;div class=&quot;flex items-center px-4&quot;&gt;
        &lt;div class=&quot;flex-shrink-0&quot;&gt;
          &lt;svg class=&quot;h-10 w-10 fill-current text-gray-400&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;currentColor&quot;&gt;
            &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z&quot; /&gt;
          &lt;/svg&gt;
        &lt;/div&gt;

        &lt;div class=&quot;ml-3&quot;&gt;
          &lt;div class=&quot;font-medium text-base text-gray-800&quot;&gt;{{ Auth::user()-&gt;name }}&lt;/div&gt;
          &lt;div class=&quot;font-medium text-sm text-gray-500&quot;&gt;{{ Auth::user()-&gt;email }}&lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class=&quot;mt-3 space-y-1&quot;&gt;
        &lt;!-- Authentication --&gt;
        &lt;form method=&quot;POST&quot; action=&quot;{{ route('logout') }}&quot;&gt;
          @csrf

          &lt;x-responsive-nav-link :href=&quot;route('logout')&quot; onclick=&quot;event.preventDefault();
                                        this.closest('form').submit();&quot;&gt;
            {{ __('Logout') }}
          &lt;/x-responsive-nav-link&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;

</code></pre>
<h2 id="tweet-データの編集"><a class="header" href="#tweet-データの編集">tweet データの編集</a></h2>
<p>phpmyadmin で tweets テーブルのデータを確認し，レコード毎に<code>user_id</code>が異なるよう調整しておく．</p>
<h2 id="動作確認マイページ"><a class="header" href="#動作確認マイページ">動作確認（マイページ）</a></h2>
<p>下図のようにマイページへのリンクが表示される．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_mypage_nav.png" alt="マイページへのリンク" /></p>
<p>マイページを表示させ，ログインしているユーザのデータのみ表示されることを確認する．異なるユーザでログインし，個別にデータが表示されることを確認しても良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_mypage.png" alt="マイページへのリンク" /></p>
<h2 id="一覧ページでログインユーザの投稿のみ編集削除できるようにする"><a class="header" href="#一覧ページでログインユーザの投稿のみ編集削除できるようにする">一覧ページでログインユーザの投稿のみ編集削除できるようにする</a></h2>
<p>現状，一覧ページでは全ての投稿に対して編集や削除が行える状態である．これを下記のようにしたい．</p>
<ul>
<li>ログインしているユーザは自分の投稿を編集削除できる．</li>
<li>自分以外のユーザの投稿は閲覧のみ可能．</li>
</ul>
<p>一覧画面のビューファイル内で条件分岐を行い，編集ボタンと削除ボタンの表示非表示を制御することで実現できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 条件分岐でログインしているユーザが投稿したtweetのみ編集ボタンと削除ボタンが表示される --&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認編集削除ボタンの表示非表示"><a class="header" href="#動作確認編集削除ボタンの表示非表示">動作確認（編集削除ボタンの表示非表示）</a></h2>
<p>自分の投稿のみ編集ボタンと削除ボタンが表示されれば OK！</p>
<p>phpmyadmin で <code>user_id</code> カラムを適当に編集しながら確認すると良いだろう．</p>
<p><img src="laravel/laravel03/./img/laratter_index_switch_edit_remove.png" alt="編集削除ボタンの表示非表示適用" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="投稿者名の表示多対-1-のデータ"><a class="header" href="#投稿者名の表示多対-1-のデータ">投稿者名の表示（多対 1 のデータ）</a></h1>
<p>一覧ページでログインユーザのみが編集と削除を行えるようにしたが，このままでは tweet がどのユーザによって行われたのかを画面から判別できない．</p>
<p>そこで，各 tweet にユーザ名を表示して tweet の識別ができるようにする．</p>
<h2 id="多対-1-のデータ構造"><a class="header" href="#多対-1-のデータ構造">多対 1 のデータ構造</a></h2>
<p>tweet とユーザの関係は「多対 1」である（1 対多の逆）．</p>
<p>Laravel では，この場合も連携ができる機能が準備されている．</p>
<p>設定はモデル部分に記述する．<code>app/Http/Models/Tweet.php</code>を以下のように編集する．</p>
<p>子のモデルに<code>belongsTo()</code>を設定することで親のモデルを指定することができる．これで「Tweet モデルは User モデルに属している」状態となる．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  protected $guarded = [
    'id',
    'created_at',
    'updated_at',
  ];

  public static function getAllOrderByDeadline()
  {
    return self::orderBy('updated_at', 'desc')-&gt;get();
  }

  // 🔽 追加
  public function user()
  {
    return $this-&gt;belongsTo(User::class);
  }

}

</code></pre>
<h2 id="連携したデータの呼び出し"><a class="header" href="#連携したデータの呼び出し">連携したデータの呼び出し</a></h2>
<p>モデルに多対 1 の関係を指定できたので，<code>user</code>関数を用いて子のデータから親のデータを呼び出せるようになった．</p>
<p>ビューファイルでは tweet の内容を表示しているので，<code>$tweet-&gt;user-&gt;name</code>のように指定することで親データ（この場合は<code>name</code>）を取得できる．</p>
<p><code>resources/views/tweet/index.blade.php</code>を以下のように編集する．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;!-- 🔽 追加 --&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-4"><a class="header" href="#動作確認-4">動作確認</a></h2>
<p>一覧画面で各 tweet に投稿者名が表示されれば OK！</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_auther.png" alt="投稿者名の表示" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-1多対多のデータ中間テーブル"><a class="header" href="#favorite-機能-1多対多のデータ中間テーブル">Favorite 機能 1（多対多のデータ・中間テーブル）</a></h1>
<p>ここからは SNS においてメジャーな機能である「Favorite 機能」を実装していく．</p>
<p>Favorite は多対多のデータ構造となるため，新たに中間テーブルを作成する必要がある．</p>
<h2 id="多対多のデータ構造"><a class="header" href="#多対多のデータ構造">多対多のデータ構造</a></h2>
<p>Laravel では中間テーブルの命名を「関連するテーブル A の単数形_関連するテーブル B の単数形（テーブル名はアルファベット順）」とする規則がある．</p>
<p>したがって，今回の中間テーブル名は <code>tweet_user</code> となる．</p>
<p>↓ テーブルの構造（主要なもののみ記載）</p>
<pre><code class="language-txt">users
    id - integer
    name - string

tweets
    id - integer
    tweet - string
    description - string

tweet_user
    user_id - integer
    tweet_id - integer

</code></pre>
<!-- > 📦 **Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.test bash
> root@8544d96d2334:/var/www/html#
> ``` -->
<h2 id="マイグレーションファイルの作成-1"><a class="header" href="#マイグレーションファイルの作成-1">マイグレーションファイルの作成</a></h2>
<p>テーブルの作成はマイグレーションで行う．まずはマイグレーションファイルを作成する．</p>
<pre><code class="language-bash">$ php artisan make:migration create_tweet_user_table
</code></pre>
<p>マイグレーションファイル（<code>database/migrations/2021_09_24_072924_create_tweet_user_table.php</code>）を開き，<code>up()</code> 関数を以下のように編集する．</p>
<pre><code class="language-php">// database/migrations/2021_09_24_072924_create_tweet_user_table.php

public function up()
{
  Schema::create('tweet_user', function (Blueprint $table) {
    $table-&gt;id();
    // 🔽 ここから追加
    $table-&gt;unsignedBigInteger('user_id');
    $table-&gt;unsignedBigInteger('tweet_id');
    $table-&gt;foreign('user_id')-&gt;references('id')-&gt;on('users')-&gt;onDelete('cascade');
    $table-&gt;foreign('tweet_id')-&gt;references('id')-&gt;on('tweets')-&gt;onDelete('cascade');
    $table-&gt;unique(['user_id', 'tweet_id']);
    // 🔼 ここまで追加
    $table-&gt;timestamps();
  });
}

</code></pre>
<h2 id="補足マイグレーションファイルの設定項目について"><a class="header" href="#補足マイグレーションファイルの設定項目について">【補足】マイグレーションファイルの設定項目について</a></h2>
<table><thead><tr><th>関数</th><th>意味</th></tr></thead><tbody>
<tr><td><code>foreign()</code></td><td>引数のカラムが外部キー制約であることを示す．</td></tr>
<tr><td><code>references()</code></td><td>↑ で参照する外部キーを設定する．</td></tr>
<tr><td><code>on()</code></td><td>↑ で参照するテーブルを設定する．</td></tr>
<tr><td><code>onDelete()</code></td><td>↑ で参照しているデータが削除された場合に中間テーブルのデータも削除する設定．</td></tr>
</tbody></table>
<p>上記をまとめると「中間テーブルの <code>user_id</code> は <code>users</code> テーブルの <code>id</code> を参照していて，<code>users</code> テーブルのデータが削除されると中間テーブルのデータも削除される」となる．</p>
<h2 id="マイグレーションの実行"><a class="header" href="#マイグレーションの実行">マイグレーションの実行</a></h2>
<p>マイグレーションファイルを作成したらマイグレーションを実行する．</p>
<pre><code class="language-bash">$ php artisan migrate

# 実行結果
Migrating: 2021_09_24_072924_create_tweet_user_table
Migrated:  2021_09_24_072924_create_tweet_user_table (451.37ms)

</code></pre>
<h2 id="テーブルの確認-1"><a class="header" href="#テーブルの確認-1">テーブルの確認</a></h2>
<p>phpmyadmin で，<code>tweet_user</code> テーブルが作成されていることを確認する．</p>
<pre><code class="language-txt">+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
</code></pre>
<!-- 【今回は不要】以下にコマンドで確認する場合も示す．

> 📦 **MySQL コンテナ内の操作**
>
> ```bash
> $ docker-compose exec mysql bash
> root@d984f6614597:/#
> ```

```bash
$  mysql -u sail -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 347
Server version: 8.0.25 MySQL Community Server - GPL

Copyright (c) 2000, 2021, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use laratter;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+------------------------+
| Tables_in_laratter     |
+------------------------+
| failed_jobs            |
| migrations             |
| password_resets        |
| personal_access_tokens |
| tweet_user             |
| tweets                 |
| users                  |
+------------------------+
7 rows in set (0.00 sec)

mysql> desc tweet_user;
+------------+-----------------+------+-----+---------+----------------+
| Field      | Type            | Null | Key | Default | Extra          |
+------------+-----------------+------+-----+---------+----------------+
| id         | bigint unsigned | NO   | PRI | NULL    | auto_increment |
| user_id    | bigint unsigned | NO   | MUL | NULL    |                |
| tweet_id   | bigint unsigned | NO   | MUL | NULL    |                |
| created_at | timestamp       | YES  |     | NULL    |                |
| updated_at | timestamp       | YES  |     | NULL    |                |
+------------+-----------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql>
``` -->
<h2 id="モデルに多対多の連携を設定"><a class="header" href="#モデルに多対多の連携を設定">モデルに多対多の連携を設定</a></h2>
<p>User モデルに <code>belongsToMany</code> を設定して，User モデルは Tweet モデルと多対多の連携をすることを示す．</p>
<pre><code class="language-php">// app/Http/Models/User.php

&lt;?php

namespace App\Models;

use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
  use HasApiTokens, HasFactory, Notifiable;

  // 省略

  // 🔽 追加
  public function tweets()
  {
    return $this-&gt;belongsToMany(Tweet::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>同様に Tweet モデルにも <code>belongsToMany</code> を設定する．</p>
<pre><code class="language-php">// app/Http/Models/Tweet.php

&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Tweet extends Model
{
  use HasFactory;

  // 省略

  // 🔽 追加
  public function users()
  {
    return $this-&gt;belongsToMany(User::class)-&gt;withTimestamps();
  }
}

</code></pre>
<p>ここまでで，データを連携させる設定は完了となる．</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="favorite-機能-2各処理の実装"><a class="header" href="#favorite-機能-2各処理の実装">Favorite 機能 2（各処理の実装）</a></h1>
<p>データ連携の準備ができたので，各処理を実装していく．</p>
<h2 id="コントローラ生成"><a class="header" href="#コントローラ生成">コントローラ生成</a></h2>
<p>まずは，favorite 処理用のコントローラを作成する．</p>
<!-- > 📦**Laravel コンテナ内の操作**
>
> ```bash
> $ docker-compose exec laravel.testbash
> root@8544d96d2334: /var/www/html #
> ``` -->
<p>下記のコマンドを実行する．</p>
<pre><code class="language-bash">$ php artisan make:controller FavoriteController --resource

# 実行結果
Controller created successfully.

</code></pre>
<h2 id="ルーティングの設定"><a class="header" href="#ルーティングの設定">ルーティングの設定</a></h2>
<p>続いてルーティングを設定する．</p>
<p>今回は<code>favorite</code>と<code>unfavorite</code>の URI を設定し，FavoriteController の<code>store()</code>関数と<code>destroy()</code>関数をそれぞれ利用する．</p>
<pre><code class="language-php">// routes/web.php

&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\TweetController;

// 🔽 追加
use App\Http\Controllers\FavoriteController;

// 省略

Route::group(['middleware' =&gt; 'auth'], function () {
  // 🔽 追加
  Route::post('tweet/{tweet}/favorites', [FavoriteController::class, 'store'])-&gt;name('favorites');

  // 🔽 追加
  Route::post('tweet/{tweet}/unfavorites', [FavoriteController::class, 'destroy'])-&gt;name('unfavorites');

  Route::get('/tweet/mypage', [TweetController::class, 'mydata'])-&gt;name('tweet.mypage');
  Route::resource('tweet', TweetController::class);
});

Route::get('/', function () {
  return view('welcome');
});

Route::get('/dashboard', function () {
  return view('dashboard');
})-&gt;middleware(['auth'])-&gt;name('dashboard');

require __DIR__ . '/auth.php';

</code></pre>
<h2 id="コントローラの処理を実装"><a class="header" href="#コントローラの処理を実装">コントローラの処理を実装</a></h2>
<p>ルーティングで設定した<code>store()</code>関数と<code>destroy()</code>関数の中身を実装する．</p>
<p><code>app/Http/Controllers/FavoriteController.php</code>を以下のように編集する．</p>
<p><code>attach()</code>で中間テーブルへのデータの追加，<code>detach()</code>で中間テーブルからのデータ削除が実行される．</p>
<pre><code class="language-php">// app/Http/Controllers/FavoriteController.php

&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

// 🔽 2行追加
use App\Models\Tweet;
use Auth;

class FavoriteController extends Controller
{

  // 省略

  // 🔽 編集（`store()` の `()` 内も異なるので注意）
  public function store(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;attach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }

  // 🔽 編集（`destroy()` の `()` 内も異なるので注意）
  public function destroy(Tweet $tweet)
  {
    $tweet-&gt;users()-&gt;detach(Auth::id());
    return redirect()-&gt;route('tweet.index');
  }
}

</code></pre>
<h2 id="一覧画面への反映"><a class="header" href="#一覧画面への反映">一覧画面への反映</a></h2>
<p>中間テーブルへのデータ追加及び削除の処理を実装したので，最後に favorite 数を一覧画面に反映させて完成となる．</p>
<p>まず，<code>$tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists()</code>でログインしているユーザが favorite しているかどうかを判定する．</p>
<p>既 favorite の場合は unfavorite するボタンを，未 favorite の場合は favorite するボタンを条件分岐で表示する．</p>
<p>それぞれのボタン部分では favorite 件数を表示する．<code>$tweet-&gt;users()-&gt;count()</code> で中間テーブルのデータ件数を取得することができる．</p>
<pre><code class="language-php">&lt;!-- resources/views/tweet/index.blade.php --&gt;

&lt;x-app-layout&gt;
  &lt;x-slot name=&quot;header&quot;&gt;
    &lt;h2 class=&quot;font-semibold text-xl text-gray-800 leading-tight&quot;&gt;
      {{ __('Tweet Index') }}
    &lt;/h2&gt;
  &lt;/x-slot&gt;

  &lt;div class=&quot;py-12&quot;&gt;
    &lt;div class=&quot;max-w-7xl mx-auto sm:w-10/12 md:w-8/10 lg:w-8/12&quot;&gt;
      &lt;div class=&quot;bg-white overflow-hidden shadow-sm sm:rounded-lg&quot;&gt;
        &lt;div class=&quot;p-6 bg-white border-b border-gray-200&quot;&gt;
          &lt;table class=&quot;text-center w-full border-collapse&quot;&gt;
            &lt;thead&gt;
              &lt;tr&gt;
                &lt;th class=&quot;py-4 px-6 bg-grey-lightest font-bold uppercase text-lg text-grey-dark border-b border-grey-light&quot;&gt;tweet&lt;/th&gt;
              &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
              @foreach ($tweets as $tweet)
              &lt;tr class=&quot;hover:bg-grey-lighter&quot;&gt;
                &lt;td class=&quot;py-4 px-6 border-b border-grey-light&quot;&gt;
                  &lt;a href=&quot;{{ route('tweet.show',$tweet-&gt;id) }}&quot;&gt;
                    &lt;p class=&quot;text-left text-grey-dark&quot;&gt;{{$tweet-&gt;user-&gt;name}}&lt;/p&gt;
                    &lt;h3 class=&quot;text-left font-bold text-lg text-grey-dark&quot;&gt;{{$tweet-&gt;tweet}}&lt;/h3&gt;
                  &lt;/a&gt;
                  &lt;div class=&quot;flex&quot;&gt;
                    &lt;!-- 🔽 追加 --&gt;
                    &lt;!-- favorite 状態で条件分岐 --&gt;
                    @if($tweet-&gt;users()-&gt;where('user_id', Auth::id())-&gt;exists())
                    &lt;!-- unfavorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('unfavorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-red py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;red&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;red&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @else
                    &lt;!-- favorite ボタン --&gt;
                    &lt;form action=&quot;{{ route('favorites',$tweet) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;flex mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-black py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-red-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z&quot; /&gt;
                        &lt;/svg&gt;
                        {{ $tweet-&gt;users()-&gt;count() }}
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif

                    @if ($tweet-&gt;user_id === Auth::user()-&gt;id)
                    &lt;!-- 更新ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.edit',$tweet-&gt;id) }}&quot; method=&quot;GET&quot; class=&quot;text-left&quot;&gt;
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    &lt;!-- 削除ボタン --&gt;
                    &lt;form action=&quot;{{ route('tweet.destroy',$tweet-&gt;id) }}&quot; method=&quot;POST&quot; class=&quot;text-left&quot;&gt;
                      @method('delete')
                      @csrf
                      &lt;button type=&quot;submit&quot; class=&quot;mr-2 ml-2 text-sm hover:bg-gray-200 hover:shadow-none text-white py-1 px-2 focus:outline-none focus:shadow-outline&quot;&gt;
                        &lt;svg class=&quot;h-6 w-6 text-gray-500&quot; fill=&quot;none&quot; viewBox=&quot;0 0 24 24&quot; stroke=&quot;black&quot;&gt;
                          &lt;path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;1&quot; d=&quot;M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16&quot; /&gt;
                        &lt;/svg&gt;
                      &lt;/button&gt;
                    &lt;/form&gt;
                    @endif
                  &lt;/div&gt;
                &lt;/td&gt;
              &lt;/tr&gt;
              @endforeach
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/x-app-layout&gt;

</code></pre>
<h2 id="動作確認-5"><a class="header" href="#動作確認-5">動作確認</a></h2>
<p>下図のように favorite ボタンが表示され，favorite 件数が表示されていれば OK．</p>
<p>ここまでで Twitter ライクな SNS アプリケーションの実装は完了である．</p>
<p><img src="laravel/laravel03/./img/laratter_index_add_favorite.png" alt="favorite機能追加" /></p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="github-へ-push"><a class="header" href="#github-へ-push">GitHub へ push</a></h1>
<p>Paiza Cloud 上で開発したプロダクトをデプロイする場合，下記の手順で行うとスムーズである．</p>
<ol>
<li>Paiza Cloud から GitHub へソースコードを push する．</li>
<li>ローカル PC のターミナルでデプロイ先サーバにアクセスし，GitHub のソースコードを clone する．</li>
<li>DB など必要に応じてクライアントツールを使用して設定する．</li>
</ol>
<p>本項では上記「1」の手順を解説する．</p>
<h2 id="paiza-cloud-環境の-ssh-鍵ファイルの準備"><a class="header" href="#paiza-cloud-環境の-ssh-鍵ファイルの準備">Paiza Cloud 環境の SSH 鍵ファイルの準備</a></h2>
<blockquote>
<p>💻 Paiza Cloud ターミナルの操作</p>
</blockquote>
<p>ホームディレクトリ直下に鍵ファイルを保存するための <code>.ssh</code> フォルダを作成し，移動する．</p>
<pre><code class="language-bash">$ cd ~
$ mkdir .ssh
$ cd .ssh
</code></pre>
<p>SSH 鍵ファイルを作成する．ファイル名は既定のまま，パスワードは空欄で OK なのでそのまま Enter で進める．</p>
<pre><code class="language-bash">$ ssh-keygen

Generating public/private rsa key pair.
Enter file in which to save the key (/home/ubuntu/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/ubuntu/.ssh/id_rsa.
Your public key has been saved in /home/ubuntu/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:33yZ6Zkm1ZNfm28N2zTsii8ZPUX0YnJ27/3DC7a9lDg ubuntu@laravel-test
The key's randomart image is:
+---[RSA 2048]----+
|              .. |
|               ..|
|            . * o|
|             = +.|
|        S   . o.o|
|         . + o+X*|
|          . =EOB@|
|           o+oOO*|
|           .o*==B|
+----[SHA256]-----+

</code></pre>
<p>公開鍵ファイルの中身を表示する．</p>
<pre><code class="language-bash">$ cat id_rsa.pub

ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbFShwJXqs23OuKYHG9EPbHObzWqO1Lua6m/BC4aVyqo82i9tS6ZDKXTXEUMqhtba1WadmXMPEY4yT6f9KSueEHn7lQFWoXSmqGQ1amUSGSPth589k3pnO+83AWwdhb0M4AUv684FX+SCGNBV0o01R63tSmXMf++MzxpvC17rKDPpIjM/olyt3XF+p/IfAJvJUEq7uTHTgqSAXgAc/Epnv8QoT74XiqeA5fLNbcrrFCMKj8kuv5XhAht3K1ryWULduZ0rOUjRosntUxDFyBbM2HWsi+ABKJagxnqkmMAa0dSC5KuZXurtzYOdf1GaR3A/AMr5gX8G2j3/23auUO413 ubuntu@laravel-test
</code></pre>
<h2 id="github-に公開鍵を設定"><a class="header" href="#github-に公開鍵を設定">GitHub に公開鍵を設定</a></h2>
<blockquote>
<p>🌏 ブラウザの操作</p>
</blockquote>
<p>GitHub のサイトにアクセスし，「設定」→「SSH keys」へ進む．「Add SSH key」をクリックして入力画面へ進む．</p>
<p>ターミナルに表示された文字列を「ssh-rsa」から全てコピーし，GitHub サイトの入力欄に貼り付ける．タイトルは PC 名など適当につけて OK．
入力したら「Add key」をクリックして終了．</p>
<p>※公開鍵は PC 毎にペアを作成するため，どの PC で発行した公開鍵なのか判別できるように名前をつけると良い．</p>
<h2 id="git-の設定"><a class="header" href="#git-の設定">Git の設定</a></h2>
<blockquote>
<p>💻 Paiza Cloud ターミナルの操作</p>
</blockquote>
<p>プロジェクトのディレクトリに移動する．</p>
<pre><code class="language-bash">$ cd ~
$ cd laratter

</code></pre>
<p>GitHub アカウントの情報を設定する．<strong>必ず自分のアカウントの情報を入力すること．</strong></p>
<pre><code class="language-bash">$ git config --global user.name &quot;YOUR_GITHUB_ACCOUNT_NAME&quot;
$ git config --global user.email &quot;YOUR_GITHUB_EMAIL&quot;

</code></pre>
<p>デフォルトブランチを <code>main</code> に変更する．</p>
<pre><code class="language-bash">$ git config --global init.defaultBranch main
</code></pre>
<h2 id="コミットしてプッシュする"><a class="header" href="#コミットしてプッシュする">コミットしてプッシュする．</a></h2>
<blockquote>
<p>🌏 ブラウザの操作</p>
</blockquote>
<p>GitHub 上に新規リポジトリを作成しておく．</p>
<p>作成したら，SSH の URL を控えておく．</p>
<blockquote>
<p>💻 Paiza Cloud ターミナルの操作</p>
</blockquote>
<pre><code class="language-bash">$ git init

# 実行結果
Initialized empty Git repository in /home/ubuntu/laratter/.git/


# ファイルを add -&gt; commit する
$ git add .
$ git commit -m &quot;init&quot;

# 実行結果（中略）
[main (root-commit) 5b761c0] init
 85 files changed, 10026 insertions(+)
 create mode 100644 .editorconfig
 create mode 100644 .env.example
 create mode 100644 tests/Unit/ExampleTest.php
 create mode 100644 webpack.mix.js

# リポジトリの URL （SSH）を設定してpushする．
$ git remote add origin YOUR_REPOSITORY_URL
$ git push origin main

# 実行結果（途中で ` (yes/no)?` と訊かれるので `yes` と入力してEnter）
The authenticity of host 'github.com (52.192.72.89)' can't be established.
RSA key fingerprint is SHA256:nThbg6kXUpJWGl7E1IGOCspRomTxdCARLviKw6E5SY8.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'github.com,52.192.72.89' (RSA) to the list of knownhosts.
Counting objects: 110, done.
Delta compression using up to 3 threads.
Compressing objects: 100% (91/91), done.
Writing objects: 100% (110/110), 69.46 KiB | 3.66 MiB/s, done.
Total 110 (delta 7), reused 0 (delta 0)
remote: Resolving deltas: 100% (7/7), done.
To github.com:taroosg/paiza-cloud-test.git
 * [new branch]      main -&gt; main

</code></pre>
<p>これでソースコードが GitHub に push されれば OK！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
